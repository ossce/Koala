!function(window){var doc=window.document,shopWeUI={};var util=shopWeUI.util={pageScroll:function(){var fn=function(e){e.preventDefault();e.stopPropagation()};var islock=false;return{lock:function(){if(islock){return}islock=true;doc.addEventListener("touchmove",fn)},unlock:function(){islock=false;doc.removeEventListener("touchmove",fn)}}}(),};$.fn.emulateTransitionEnd=function(duration){};if(typeof define==="function"){define(shopWeUI)}else{window.ShopWeUI=shopWeUI}var $body=$(window.document.body);function AddressSelect(element,options){this.$element=$(element);this.options=$.extend({},AddressSelect.DEFAULTS,options||{});this.init()}AddressSelect.DEFAULTS={provance:"",city:"",area:""};AddressSelect.prototype.init=function(){var _that=this,options=_that.options;if(typeof WEUI_CITYS=="undefined"){return}_that.citys=WEUI_CITYS;_that.createDOM();_that.defaultSet={provance:options.provance,city:options.city,area:options.area}};AddressSelect.prototype.open=function(){var _that=this;$body.append(_that.$mask);ShopWeUI.device.isMozilla&&_that.$element.blur();_that.$mask.on("click.mask-black",function(){_that.close()});var $addressElement=_that.$addressElement,defaultSet=_that.defaultSet;$addressElement.find(".addressSelect-content").removeClass("addressSelect-move-animate addressSelect-next addressSelect-prev");_that.loadProvance();if(defaultSet.provance){_that.setNavTxt(0,defaultSet.provance)}else{$addressElement.find(".addressSelect-nav a").eq(0).addClass("crt").html("请选择")}if(defaultSet.city){_that.loadCity();_that.setNavTxt(1,defaultSet.city)}if(defaultSet.area){_that.loadArea();_that.ForwardView(false);_that.setNavTxt(2,defaultSet.area)}$addressElement.addClass("brouce-in")};AddressSelect.prototype.close=function(){var _that=this;_that.$mask.remove();_that.$addressElement.removeClass("brouce-in").find(".addressSelect-nav a").removeClass("crt").html("");_that.$addressBox.html("")};AddressSelect.prototype.createDOM=function(){var _that=this;_that.$mask=$('<div class="mask-black"></div>');_that.$addressElement=$(""+'<div class="m-addressSelect">'+'<div class="addressSelect-header">'+'<p class="addressSelect-title">所在地区</p>'+'<div class="addressSelect-nav">'+'<a href="javascript:;" ></a>'+'<a href="javascript:;"></a>'+'<a href="javascript:;"></a>'+"</div>"+"</div>"+'<ul class="addressSelect-content">'+'<li class="addressSelect-item">'+'<div class="addressSelect-item-box"></div>'+"</li>"+'<li class="addressSelect-item">'+'<div class="addressSelect-item-box"></div>'+"</li>"+'<li class="addressSelect-item">'+'<div class="addressSelect-item-box"></div>'+"</li>"+"</ul>"+"</div>");$body.append(_that.$addressElement);_that.$addressBox=_that.$addressElement.find(".addressSelect-item-box");_that.$addressElement.on("click.addressSelect",".addressSelect-nav a",function(){var $this=$(this);$this.addClass("crt").siblings().removeClass("crt");$this.index()<2?_that.backOffView():_that.ForwardView(true)})};AddressSelect.prototype.setNavTxt=function(index,txt){var $nav=this.$addressElement.find(".addressSelect-nav a");index<2&&$nav.removeClass("crt");$nav.eq(index).html(txt);$nav.eq(index+1).addClass("crt").html("请选择");$nav.eq(index+2).removeClass("crt").html("")};AddressSelect.prototype.backOffView=function(){this.$addressElement.find(".addressSelect-content").removeClass("addressSelect-next").addClass("addressSelect-move-animate addressSelect-prev")};AddressSelect.prototype.ForwardView=function(animate){this.$addressElement.find(".addressSelect-content").removeClass("addressSelect-move-animate addressSelect-prev").addClass((animate?"addressSelect-move-animate":"")+" addressSelect-next")};AddressSelect.prototype.bindItemEvent=function(){var _that=this,$addressElement=_that.$addressElement;$addressElement.on("click.addressSelect",".addressSelect-item-box a",function(){var $this=$(this);if($this.hasClass("crt")){return}$this.addClass("crt").siblings().removeClass("crt");var tag=$this.data("tag");_that.setNavTxt(tag,$this.text());var $nav=$addressElement.find(".addressSelect-nav a"),defaultSet=_that.defaultSet;if(tag==0){_that.loadCity();$addressElement.find(".addressSelect-item-box").eq(1).find("a").removeClass("crt")}else{if(tag==1){_that.loadArea();_that.ForwardView(true);$addressElement.find(".addressSelect-item-box").eq(2).find("a").removeClass("crt")}else{defaultSet.provance=$nav.eq(0).html();defaultSet.city=$nav.eq(1).html();defaultSet.area=$nav.eq(2).html();_that.returnValue()}}})};AddressSelect.prototype.returnValue=function(){var _that=this,defaultSet=_that.defaultSet;_that.$element.trigger($.Event("address-select",{provance:defaultSet.provance,city:defaultSet.city,area:defaultSet.area}));_that.close()};AddressSelect.prototype.scrollPosition=function(index){var _that=this,$addressBox=_that.$addressBox.eq(index),itemHeight=$addressBox.find("a.crt").height(),itemBoxHeight=$addressBox.parent().height();$addressBox.parent().animate({scrollTop:$addressBox.find("a.crt").index()*itemHeight-itemBoxHeight/3},0,function(){_that.bindItemEvent()})};AddressSelect.prototype.fillItems=function(index,arr){var _that=this;
_that.$addressBox.eq(index).html(arr).parent().animate({scrollTop:0},10);_that.scrollPosition(index)};AddressSelect.prototype.loadProvance=function(){var _that=this;var arr=[];$.each(_that.citys,function(k,v){arr.push($('<a class="'+(v.n==_that.defaultSet.provance?"crt":"")+'" href="javascript:;"><span>'+v.n+"</span></a>").data({citys:v.c,tag:0}))});_that.fillItems(0,arr)};AddressSelect.prototype.loadCity=function(){var _that=this;var cityData=_that.$addressBox.eq(0).find("a.crt").data("citys");var arr=[];$.each(cityData,function(k,v){arr.push($('<a class="'+(v.n==_that.defaultSet.city?"crt":"")+'" href="javascript:;"><span>'+v.n+"</span></a>").data({citys:v.a,tag:1}))});_that.fillItems(1,arr)};AddressSelect.prototype.loadArea=function(){var _that=this;var areaData=_that.$addressBox.eq(1).find("a.crt").data("citys");var arr=[];$.each(areaData,function(k,v){arr.push($('<a class="'+(v==_that.defaultSet.area?"crt":"")+'" href="javascript:;"><span>'+v+"</span></a>").data({tag:2}))});if(arr.length<=0){arr.push($('<a href="javascript:;"><span>全区</span></a>').data({tag:2}))}_that.fillItems(2,arr)};function Plugin(option){var args=Array.prototype.slice.call(arguments,1);return this.each(function(){var $this=$(this),addressSelect=$this.data("addressSelect");if(!addressSelect){$this.data("addressSelect",(addressSelect=new AddressSelect(this,option)))}if(typeof option=="string"){addressSelect[option]&&addressSelect[option].apply(addressSelect,args)}})}$.fn.addressSelect=Plugin}(window);!function(window){var doc=window.document,shopWeUI=window.ShopWeUI,ua=window.navigator&&window.navigator.userAgent||"";var ipad=!!ua.match(/(iPad).*OS\s([\d_]+)/),ipod=!!ua.match(/(iPod)(.*OS\s([\d_]+))?/),iphone=!ipad&&!!ua.match(/(iPhone\sOS)\s([\d_]+)/);shopWeUI.device={}}(window);