<style type="text/css">
.star_ul li {
    float: left;
    margin-right: 5px;
    list-style-type: none;
    overflow: hidden;
    margin-top: 5px;
	cursor: pointer;
}
.star_ul img {
    width: 25px;
    vertical-align: text-bottom;
}
</style>
<div class="main">
	<form id="commentForm" method="post" class="form-horizontal form" onsubmit="return checksubmit();">
        <div class="panel panel-default">
            <div class="panel-heading">新增课程评价</div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">课程名称</label>
                    <div class="col-sm-9">
						<input type="text" value="{$lesson['bookname']}" class="form-control" readonly>
                    </div>
                </div>
				<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class="require">*</span> 用户昵称</label>
                    <div class="col-sm-9">
                        <input type="text" name="virtual_nickname" class="form-control" >
                    </div>
                </div>
				<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class="require">*</span> 用户头像</label>
                    <div class="col-sm-9">
                        {php echo tpl_form_field_image('virtual_avatar', '');}
                    </div>
                </div>
				<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">评价级别</label>
                    <div class="col-sm-9">
                        <p class="form-control-static">
							<label>
								<input type="radio" name="grade" value="1" checked/> <span class="label" style="background-color:#FB5B5B;">好评</span>
							</label>
							&nbsp;&nbsp;
							<label>
								<input type="radio" name="grade" value="2"/> <span class="label" style="background-color:#D99810;">中评</span>
							</label>
							&nbsp;&nbsp;
							<label>
								<input type="radio" name="grade" value="3"/> <span class="label" style="background-color:#555555;">差评</span>
							</label>
                        </p>
                    </div>
                </div>
				<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">{php echo $evaluate_page['global_score'] ? $evaluate_page['global_score'] : '综合评分';}</label>
                    <div class="col-sm-9">
						<div id="global_score" currentindex="5">
							<ul class="star_ul">
								<li num="1"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="2"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="3"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="4"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="5"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<div class="clear"></div>
							</ul>
							<input type="hidden" name="global_score" value="5">
						</div>
                    </div>
                </div>
				<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">{php echo $evaluate_page['content_score'] ? $evaluate_page['content_score'] : '内容实用';}</label>
                    <div class="col-sm-9">
						<div id="content_score" currentindex="5">
							<ul class="star_ul">
								<li num="1"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="2"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="3"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="4"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="5"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<div class="clear"></div>
							</ul>
							<input type="hidden" name="content_score" value="5">
						</div>
                    </div>
                </div>
				<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">{php echo $evaluate_page['understand_score'] ? $evaluate_page['understand_score'] : '通俗易懂';}</label>
                    <div class="col-sm-9">
						<div id="understand_score" currentindex="5">
							<ul class="star_ul">
								<li num="1"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="2"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="3"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="4"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<li num="5"><img src="{MODULE_URL}static/mobile/{$template}/images/star_full.png"></li>
								<div class="clear"></div>
							</ul>
							<input type="hidden" name="understand_score" value="5">
						</div>
                    </div>
                </div>
				<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class="require">*</span> 评价内容</label>
					<div class="col-sm-9">
                        <p class="form-control-static">
							<textarea name="content"  class="form-control" style="height:80px;"></textarea>
                        </p>
                    </div>
                </div>
                <div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class="require">*</span> 评价状态</label>
					<div class="col-sm-9">
						<p class="form-control-static">
							<label>
								<input type="radio" name="status" value="0"/>
								<span class="label label-primary" style="vertical-align:text-top;">待审核</span>
							</label>
							&nbsp;&nbsp;
							<label>
								<input type="radio" name="status" value="1" checked/>
								<span class="label label-success" style="vertical-align:text-top;">已审核</span>
							</label>
							&nbsp;&nbsp;
							<label>
								<input type="radio" name="status" value="-1"/>
								<span class="label label-default" style="vertical-align:text-top;">审核未通过</span>
							</label>
						</p>
					</div>
				</div>
				<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">回复内容</label>
                    <div class="col-sm-9">
                        <p class="form-control-static">
							<textarea name="reply"  class="form-control" style="height:80px;"></textarea>
                        </p>
                    </div>
                </div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span class="require">*</span> 评价时间</label>
					<div class="col-sm-9">
						{php echo _tpl_form_field_date('addtime', date('Y-m-d H:i:s', time()), true);}
					</div>
				</div>
				<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
                    <div class="col-sm-9">
						<input type="hidden" name="lessonid" value="{$lessonid}" />
						<input type="hidden" name="token" value="{$_W['token']}" />
                        <input type="submit" name="submit" class="btn btn-primary" value="提交" />
                    </div>
                </div>
            </div>
        </div>
	</form>
</div>

<script type="text/javascript">
	var isclick = false;
	var star_empty = "{MODULE_URL}static/mobile/default/images/star_empty.png";
	var star_full = "{MODULE_URL}static/mobile/default/images/star_full.png";
	
	function change(mydivid,num) {
		if (!isclick) {
			var tds = $("#"+mydivid+" ul li");
			for (var i = 0; i < num; i++) {
				var td = tds[i];
				$(td).find("img").attr("src", star_full);
			}
			var tindex = $("#"+mydivid).attr("currentIndex");
			tindex = tindex==0?0:tindex+1;
			for (var j = num; j < tindex; j++) {
				var td = tds[j];
				$(td).find("img").attr("src", star_empty);
			}
			$("#"+mydivid).attr("currentIndex", num);
			$('input[name=' + mydivid + ']').val(num);
		}
	}
	function change1(mydivid,num) {
		if (!isclick) {
			change(mydivid,num);
		}
		else {
			alert("请对课程进行总体评价");
		}
	}

	$(function(){
		initEvent('global_score');
		initEvent('content_score');
		initEvent('understand_score');
	});
	function initEvent(mydivid) {
		var tds = $("#"+mydivid+" ul li");
		for (var i = 0; i < tds.length; i++) {
			var td = tds[i];
			$(td).on('click',function(){
				var num = $(this).attr("num");
				change1(mydivid,num);
			});
		}
	}

	function checksubmit(){
		var virtual_nickname = $('input[name="virtual_nickname"]').val();
		var virtual_avatar = $('input[name="virtual_avatar"]').val();
		var content = $('textarea[name="content"]').val();
		
		if(!virtual_nickname){
			util.message('请填写用户昵称');
			return false;
		}
		if(!virtual_avatar){
			util.message('请上传用户头像');
			return false;
		}
		if(!content){
			util.message('请填写评论内容');
			return false;
		}
		
		document.getElementById("commentForm").submit();
	}
</script>